{
  "Logging": {
    "LogLevel": {
      "Default": "Debug",
      "Microsoft": "Warning",
      "Microsoft.Hosting.Lifetime": "Information",
      "Yarp.ReverseProxy.Configuration.ConfigProvider.ConfigurationConfigProvider": "Warning",
      "Yarp.ReverseProxy.Forwarder.HttpForwarder": "Warning",
      "Yarp.ReverseProxy.Limits": "Warning",
      "TlsConnection": "Warning",
      "HttpConnection": "Warning"
    }
  },
  "AllowedHosts": "*",
  "ServerIp": null, //服务器IP，默认null为不启用，是ClientFrame启用模式
  "Server.Urls": [ //启动相关服务
    //"https://pipe:/12345",
    //"https://unix://10001",
    "https://0.0.0.0:7080",
    "http://0.0.0.0:7081"
  ],
  "HttpSsl": { //HTTPS相关配置
    "AliasHosts": {
      "nixue.top": [ "a1.nixue.top", "a2.nixue.top", "a3.nixue.top" ]
    },
    "nixue.top": {
      "Pfx": [ "certs\\cert.pfx", "certimate" ],
      "CipherSuites": [ "TLS_AES_256_GCM_SHA384", "TLS_AES_128_GCM_SHA256", "TLS_CHACHA20_POLY1305_SHA256" ],
      "SslProtocols": [ "Tls12", "Tls13" ],
      "ApplicationProtocols": [ "Http11", "Http2", "Http3" ],
      "AllowRenegotiation": true,
      "AllowTlsResume": true,
      "ClientCertificateRequired": false,
      "CertificateRevocationCheckMode": "Offline",
      "EncryptionPolicy": "AllowNoEncryption"
    },
    "www.nixue.top": {
      "Pfx": [ "certs\\cert.pfx", "certimate" ],
      "CipherSuites": [
        "TLS_AES_256_GCM_SHA384",
        "TLS_AES_128_GCM_SHA256",
        "TLS_CHACHA20_POLY1305_SHA256",
        "TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256",

        // TLS 1.3 套件
        "TLS_AES_128_CCM_SHA256",
        "TLS_AES_128_CCM_8_SHA256",

        // TLS 1.2 ECDHE 套件
        "TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384",
        "TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256",
        "TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256",
        "TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384",
        "TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305_SHA256",

        // TLS 1.2 CBC 模式套件
        "TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256",
        "TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384",
        "TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA",
        "TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA",

        // RSA 密钥交换套件
        "TLS_RSA_WITH_AES_128_GCM_SHA256",
        "TLS_RSA_WITH_AES_256_GCM_SHA384",
        "TLS_RSA_WITH_AES_128_CBC_SHA256",
        "TLS_RSA_WITH_AES_256_CBC_SHA256",
        "TLS_RSA_WITH_AES_128_CBC_SHA",
        "TLS_RSA_WITH_AES_256_CBC_SHA",

        // 传统套件（不推荐）
        "TLS_RSA_WITH_3DES_EDE_CBC_SHA",
        "TLS_ECDHE_RSA_WITH_3DES_EDE_CBC_SHA"
      ]
    },
    "nas.nixue.top": {
      "Pem": [ "certs\\nas.pem", "certs\\nas.key" ]
      //"Pfx": [ "certs/nas.pfx", "certimate" ]
      //"SslProtocols": [ "Tls", "Tls11", "Tls12", "Tls13" ]
      //"CipherSuites": [ "TLS_AES_256_GCM_SHA384", "TLS_AES_128_GCM_SHA256", "TLS_CHACHA20_POLY1305_SHA256" ]
    },
    "hkr1985.com": {
      "Pem": [ "certs\\hkr1985.com.pem", "certs\\hkr1985.com.key" ]
      //"Pfx": [ "certs/nas.pfx", "certimate" ]
    }
  },
  //"YarpPolicy": {
  //  "AuthorizationPolicy": {
  //    "DefaultPolicy": "DefaultAuthPolicy",
  //    "Policies": {
  //      "DefaultAuthPolicy": {
  //        "Enabled": true,
  //        "AuthenticationSchemes": [ "Bearer" ],
  //        "RequireAuthenticatedUser": true,
  //        "RequireClaim": [
  //          {
  //            "Type": "scope",
  //            "Value": "api.read"
  //          }
  //        ]
  //      }
  //    }
  //  },
  //  "CorsPolicy": {
  //    "DefaultPolicy": "DefaultCorsPolicy",
  //    "Policies": {
  //      "DefaultCorsPolicy": {
  //        "Enabled": true,
  //        "AllowAnyOrigins": [ "http://baidu.com" ],
  //        "AllowAnyMethod": true,
  //        "AllowAnyHeader": true,
  //        "ExposeHeaders": [ "X-Total-Count" ],
  //        "MaxAge": 3600,
  //        "AllowCredentials": true
  //      }
  //    }
  //  },
  //  "OutputCachePolicy": {
  //    "DefaultPolicy": "DefaultOutputCachePolicy",
  //    "Policies": {
  //      "DefaultOutputCachePolicy": {
  //        "Enabled": true,
  //        "Duration": 60, // 缓存持续时间，单位秒
  //        "VaryByQueryKeys": [ "*" ], // 缓存时变更的查询参数
  //        "VaryByHeader": [ "Accept", "User-Agent" ] // 缓存时变更的请求头
  //      }
  //    }
  //  },
  //  "RateLimiterPolicy": {
  //    "DefaultPolicy": "DefaultRateLimit",
  //    "Policies": {
  //      "DefaultRateLimit": {
  //        "Enabled": true,
  //        "PermitLimit": 3, // 每分钟允许 3 次请求
  //        "Window": 60, // 时间窗口为 60 秒（1分钟）
  //        "QueueLimit": 0, // 不排队，直接拒绝超额请求
  //        "AutoReplenishment": true
  //      }
  //    }
  //  },
  //  "TimeoutPolicy": {
  //    "DefaultPolicy": "DefaultTimeout",
  //    "DefaultTimeout": {
  //      "Enabled": true,
  //      "Timeout": 30
  //    }
  //  }
  //},
  "ReverseProxy": { //代理溯源
    "Routes": {
      "route3": {
        "ClusterId": "fake", //该名称会在没有匹配时使用虚假配置覆盖
        "AuthorizationPolicy": "",
        "CorsPolicy": "",
        "OutputCachePolicy": "",
        "RateLimiterPolicy": "",
        "TimeoutPolicy": "",
        "Match": {
          "Path": "mis/{**remainder}",
          "Hosts": [ "nas.nixue.top:7081" ]
        },
        "Transforms": [
          {
            "DiyType": "HeaderDistinctValue",
            "Headers": "AccessToken,Cookie"
          },
          { "PathPattern": "{**remainder}" },
          {
            "DiyType": "Location",
            "HttpType": "Request",
            "StatusCode": 302,
            "Path": "https://baidu.com/{**remainder}",
            "Enabled": true
          }
        ]
      },
      "route4": {
        "ClusterId": "test_cluster",
        "MaxRequestBodySize": -1, //禁用传输限制，字节单位
        "TimeoutPolicy": "60s",
        //"RateLimiterPolicy": "DefaultRateLimit",
        //"CorsPolicy": "DefaultCorsPolicy",
        "Match": {
          "Path": "{**catch-all}",
          "Hosts": [ "*:7081" ]
        },
        "Transforms": [
          {
            "DiyType": "W3CLogger",
            "Enabled": true,
            //"Level": "Debug",
            "LogName": "Ok"
          },
          {
            "DiyType": "HttpsRedirect",
            //"StatusCode": 302,
            //"Url": "https://127.0.0.1:8888",
            "Enabled": false
          }
        ]
      },
      "route5": {
        "ClusterId": "test_cluster",
        "TimeoutPolicy": "5s",
        "Match": {
          "Path": "/a/{**catch-all}",
          "Hosts": [ "ok.cn" ]
        },
        "Transforms": [
          {
            "DiyType": "W3CLogger",
            "Enabled": true,
            "Level": "Debug",
            "LogName": "Ok"
          },
          {
            "DiyType": "HttpsRedirect",
            //"StatusCode": 302,
            //"Url": "https://127.0.0.1:8888",
            "Enabled": false
          },
          {
            "DiyType": "Cors",
            "Enabled": true,
            "AllowOrigin": "http://example.com",
            "AllowMethods": "GET,POST",
            "AllowHeaders": "Content-Type",
            "AllowCredentials": true
          },
          {
            "DiyType": "StaticFile",
            "Enabled": false,
            "RootPath": "wwwroot" // 本地文件夹，相对路径
          }
        ]
      }
    },
    "Clusters": {
      "test_cluster": {
        "Destinations": {
          "test_cluster/destination1": {
            "Address": "http://192.168.20.22:80",
            "Host": "hkr1985.com"
          }
        },
        "HttpRequest": {
          "ActivityTimeout": "00:10:00"
        }
      }
    }
  }
}
